name: Keep Render Service Alive

on:
  schedule:
    # 10ë¶„ë§ˆë‹¤ ì‹¤í–‰ (Render ë¬´ë£Œ í”Œëœì€ 15ë¶„ ë¯¸ì‚¬ìš© ì‹œ sleep)
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  keepalive:
    name: Ping Health Endpoint
    runs-on: ubuntu-latest
    steps:
      - name: Health Check Request
        run: |
          # Render ì„œë¹„ìŠ¤ URLì„ GitHub Secretsì— ì„¤ì •í•˜ê±°ë‚˜ ì—¬ê¸°ì— ì§ì ‘ ì…ë ¥
          RENDER_URL="${{ secrets.RENDER_SERVICE_URL }}"

          if [ -z "$RENDER_URL" ]; then
            echo "âš ï¸  RENDER_SERVICE_URLì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."
            echo "GitHub Secretsì— RENDER_SERVICE_URLì„ ì¶”ê°€í•˜ì„¸ìš”."
            echo "ì˜ˆ: https://your-app.onrender.com"
            exit 0
          fi

          echo "ğŸ”„ Pinging $RENDER_URL/health..."

          response=$(curl -s -o /dev/null -w "%{http_code}" "$RENDER_URL/health" || echo "000")

          if [ "$response" = "200" ]; then
            echo "âœ… ì„œë¹„ìŠ¤ ì •ìƒ ì‘ë‹µ (HTTP $response)"
          else
            echo "âš ï¸  ì„œë¹„ìŠ¤ ì‘ë‹µ ì—†ìŒ ë˜ëŠ” ì˜¤ë¥˜ (HTTP $response)"
            echo "ì²« ìš”ì²­ì´ê±°ë‚˜ ì„œë¹„ìŠ¤ê°€ ê¹¨ì–´ë‚˜ëŠ” ì¤‘ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
          fi

          echo "ë§ˆì§€ë§‰ í•‘ ì‹œê°„: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
